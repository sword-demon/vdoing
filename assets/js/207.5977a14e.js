(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{648:function(s,a,n){"use strict";n.r(a);var t=n(16),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"核心要素以及常用操作详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#核心要素以及常用操作详解"}},[s._v("#")]),s._v(" 核心要素以及常用操作详解")]),s._v(" "),n("blockquote",[n("p",[s._v("三大核心要素：镜像、容器、仓库")])]),s._v(" "),n("h2",{attrs:{id:"仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#仓库"}},[s._v("#")]),s._v(" 仓库")]),s._v(" "),n("blockquote",[n("p",[s._v("前面 2 个不多赘述，主要说个仓库")])]),s._v(" "),n("p",[s._v("仓库是存放镜像的地方")]),s._v(" "),n("ul",[n("li",[s._v("公有仓库，Docker Hub，阿里，网易...")]),s._v(" "),n("li",[s._v("私有仓库，企业内部搭建\n"),n("ul",[n("li",[s._v("Docker Registry，Docker 官方提供的镜像仓库存储服务")]),s._v(" "),n("li",[s._v("Harbor, 是 Docker Registry 的更高级封装，它除了提供友好的 Web UI 界面，角色和用户权限管理，用户操作审计等功能")])])]),s._v(" "),n("li",[s._v("镜像访问地址形式 registry.devops.com/demo/hello:latest,若没有前面的 url 地址，则默认寻找 Docker Hub 中的镜像，若没有 tag 标签，则使用 latest 作为标签。 比如，docker pull nginx，会被解析成 docker.io/library/nginx:latest")]),s._v(" "),n("li",[s._v("公有的仓库中，一般存在这么几类镜像\n"),n("ul",[n("li",[s._v("操作系统基础镜像（centos，ubuntu，suse，alpine）")]),s._v(" "),n("li",[s._v("中间件（nginx，redis，mysql，tomcat）")]),s._v(" "),n("li",[s._v("语言编译环境（python，java，golang）")]),s._v(" "),n("li",[s._v("业务镜像（django-demo...）")])])])]),s._v(" "),n("p",[s._v("容器和仓库不会直接交互，都是以镜像为载体来操作。")]),s._v(" "),n("h2",{attrs:{id:"常用操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用操作"}},[s._v("#")]),s._v(" 常用操作")]),s._v(" "),n("h3",{attrs:{id:"查看镜像列表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看镜像列表"}},[s._v("#")]),s._v(" 查看镜像列表")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker images\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"如果获取镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如果获取镜像"}},[s._v("#")]),s._v(" 如果获取镜像")]),s._v(" "),n("h4",{attrs:{id:"从远程仓库拉取"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从远程仓库拉取"}},[s._v("#")]),s._v(" 从远程仓库拉取")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker pull nginx:alpine\ndocker images\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"使用-tag-命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-tag-命令"}},[s._v("#")]),s._v(" 使用 tag 命令")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker tag nginx:alpine xx.xx.xx.xx:5000/nginx:alpine\ndocker images\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"本地构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本地构建"}},[s._v("#")]),s._v(" 本地构建")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker build "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" -t my-nginx:ubuntu -f Dockerfile\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"如何通过镜像启动容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何通过镜像启动容器"}},[s._v("#")]),s._v(" 如何通过镜像启动容器")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run --name  my-nginx-alpine -d nginx:alpine\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("--name")]),s._v("：起一个容器的名称")]),s._v(" "),n("li",[n("code",[s._v("-d")]),s._v("：以守护进程的模式运行")])]),s._v(" "),n("h3",{attrs:{id:"如何知道容器内部运行了什么程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何知道容器内部运行了什么程序"}},[s._v("#")]),s._v(" 如何知道容器内部运行了什么程序")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器内部 分配一个 tty 终端")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it my-nginx-alpine /bin/sh\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者是 bin/bash")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"docker-怎么知道容器启动后该执行什么命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-怎么知道容器启动后该执行什么命令"}},[s._v("#")]),s._v(" docker 怎么知道容器启动后该执行什么命令")]),s._v(" "),n("blockquote",[n("p",[s._v("通过"),n("code",[s._v("docker build")]),s._v("来模拟构建一个"),n("code",[s._v("nginx")]),s._v("镜像")])]),s._v(" "),n("h4",{attrs:{id:"创建dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建dockerfile"}},[s._v("#")]),s._v(" 创建"),n("code",[s._v("Dockerfile")])]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 告诉docker使用哪个基础镜像作为模板，后续命令都以这个镜像为基础")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN命令会在上面指定的镜像里执行命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update && apt install -y nginx")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#告诉docker，启动容器时执行如下命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"构建本地镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建本地镜像"}},[s._v("#")]),s._v(" 构建本地镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker build "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" -t my-nginx:ubuntu -f Dockerfile\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"宿主机如何访问容器内服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#宿主机如何访问容器内服务"}},[s._v("#")]),s._v(" 宿主机如何访问容器内服务")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删掉旧服务,重新启动")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f my-nginx-alpine\ndocker run --name my-nginx-alpine -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":80 nginx:alpine\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:8080\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("-p")]),s._v("：本地端口:容器端口")])]),s._v(" "),n("h4",{attrs:{id:"docker-client-如何与-daemon-通信"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-client-如何与-daemon-通信"}},[s._v("#")]),s._v(" docker client 如何与 daemon 通信")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /var/run/docker.sock")]),s._v("\ndocker run --name portainer -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),s._v(":9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"导出镜像到文件中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#导出镜像到文件中"}},[s._v("#")]),s._v(" 导出镜像到文件中")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker save -o nginx-alpine.tar nginx:alpine\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"从文件中加载镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从文件中加载镜像"}},[s._v("#")]),s._v(" 从文件中加载镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker load -i nginx-alpine.tar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"删除镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除镜像"}},[s._v("#")]),s._v(" 删除镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker rmi nginx:alpine\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"容器数据持久化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器数据持久化"}},[s._v("#")]),s._v(" 容器数据持久化")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载宿主机目录")]),s._v("\ndocker run --name nginx -d -v /opt:/opt nginx:alpine\ndocker run --name mysql -e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -d -v /opt/mysql/:/var/lib/mysql mysql:5.7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"主机与容器之间拷贝数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主机与容器之间拷贝数据"}},[s._v("#")]),s._v(" 主机与容器之间拷贝数据")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机到容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/tmp/test.txt\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /tmp/test.txt nginx:/tmp\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it nginx "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/test.txt\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器拷贝到主机")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" nginx:/tmp/test.txt ./\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"查看容器日志"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看容器日志"}},[s._v("#")]),s._v(" 查看容器日志")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看全部日志")]),s._v("\ndocker logs nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实时查看最新日志")]),s._v("\ndocker logs -f nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从最新的100条开始查看")]),s._v("\ndocker logs --tail"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" -f nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"查看容器或者镜像明细"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看容器或者镜像明细"}},[s._v("#")]),s._v(" 查看容器或者镜像明细")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看容器详细信息，包括容器IP地址等")]),s._v("\ndocker inspect nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看镜像明细信息")]),s._v("\ndocker inspect nginx:alpine\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"部署镜像仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署镜像仓库"}},[s._v("#")]),s._v(" 部署镜像仓库")]),s._v(" "),n("p",[s._v("文档地址:"),n("a",{attrs:{href:"https://docs.docker.com/registry/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.docker.com/registry/"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 使用docker镜像启动镜像仓库服务")]),s._v("\ndocker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 --restart always --name registry registry:2\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 默认仓库不带认证，若需要认证，参考https://docs.docker.com/registry/deploying/#restricting-access")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"推送本地镜像到镜像仓库中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#推送本地镜像到镜像仓库中"}},[s._v("#")]),s._v(" 推送本地镜像到镜像仓库中")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ docker tag nginx:alpine localhost:5000/nginx:alpine\n$ docker push localhost:5000/nginx:alpine\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看仓库内元数据")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET http://内网ip:5000/v2/_catalog\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET http://内网ip:5000/v2/nginx/tags/list\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 镜像仓库给外部访问，不能通过localhost，尝试使用内网地址内网ip:5000/nginx:alpine")]),s._v("\n$ docker tag nginx:alpine 内网ip:5000/nginx:alpine\n$ docker push 内网ip:5000/nginx:alpine\nThe push refers to repository "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("内网ip:5000/nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nGet https://内网ip:5000/v2/: http: server gave HTTP response to HTTPS client\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## docker默认不允许向http的仓库地址推送，如何做成https的，参考：https://docs.docker.com/registry/deploying/#run-an-externally-accessible-registry")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 我们没有可信证书机构颁发的证书和域名，自签名证书需要在每个节点中拷贝证书文件，比较麻烦，因此我们通过配置daemon的方式，来跳过证书的验证：")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/docker/daemon.json\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://8xpk5wnt.mirror.aliyuncs.com"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"内网ip:5000"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n$ systemctl restart docker\n$ docker push 内网ip:5000/nginx:alpine\n$ docker images    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IMAGE ID相同，等于起别名或者加快捷方式")]),s._v("\nREPOSITORY               TAG                 IMAGE ID            CREATED             SIZE\n内网ip:5000/nginx   alpine              377c0837328f        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" weeks ago\nnginx                    alpine              377c0837328f        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" weeks ago\nlocalhost:5000/nginx     alpine              377c0837328f        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" weeks ago\nregistry                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("                   708bc6af7e5e        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" months ago\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);