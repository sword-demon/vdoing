(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{519:function(s,a,n){"use strict";n.r(a);var t=n(16),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"创建容器镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建容器镜像"}},[s._v("#")]),s._v(" 创建容器镜像")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("Docker 官方文档")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.docker.com/engine/reference/builder/"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"编写正确、高效的-dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编写正确、高效的-dockerfile"}},[s._v("#")]),s._v(" 编写正确、高效的 Dockerfile")]),s._v(" "),n("p",[s._v("写一个最简单的"),n("code",[s._v("Dockerfile")])]),s._v(" "),n("div",{staticClass:"language-Dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dockerfile.busybox")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" busybox                  # 选择基础镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),s._v("        # 启动容器时默认运行的命令")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("FROM")]),s._v(" 表示选择构建使用的基础镜像，相当于”打地基“，这里使用的是"),n("code",[s._v("busybox")])]),s._v(" "),n("li",[s._v("第二条"),n("code",[s._v("CMD")]),s._v("，它指定"),n("code",[s._v("docker run")]),s._v("启动容器之后默认运行的命令，这里是用了"),n("code",[s._v("echo")]),s._v("命令输出"),n("code",[s._v("hello world")])])]),s._v(" "),n("p",[s._v("使用"),n("code",[s._v("docker build")]),s._v("来创建出镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker build -f Dockerfile "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("Sending build context to Docker daemon  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".048kB\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/2 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM busybox\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 71a676dd070f\nStep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" CMD "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),s._v("\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" b62810bb8826\nRemoving intermediate container b62810bb8826\n ---"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" e79c13b4d138\nSuccessfully built e79c13b4d138\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("code",[s._v("-f")]),s._v("参数指定"),n("code",[s._v("Dockerfile")]),s._v("文件名，后面必须跟一个文件路径，叫做"),n("strong",[s._v("构建上下文")]),s._v("，这里是一个简单的"),n("code",[s._v(".")]),s._v("号，表示当前路径的意思；"),n("code",[s._v("Docker")]),s._v("逐行读取指令，依次创建镜像层，最后生成一个完整的镜像。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ARM-Virtual-Machine:/home/k8s-learn"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nREPOSITORY   TAG           IMAGE ID       CREATED         SIZE\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        e79c13b4d138   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".41MB\nbusybox      latest        71a676dd070f   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" months ago    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".41MB\nnginx        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.21")]),s._v("-alpine   e08a7adafd85   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" months ago    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(".1MB\nredis        latest        f16c30136ff3   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" months ago   107MB\nalpine       latest        8e1d7573f448   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" months ago   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".33MB\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("新的镜像暂时还没有名字，可以看到是一个"),n("code",[s._v("<none>")]),s._v("，但我们可以直接使用"),n("code",[s._v("IMAGE ID")]),s._v("来查看或者运行。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("wxvirus@ARM-Virtual-Machine:/etc/apt$ docker inspect e79c13b4d138\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sha256:e79c13b4d138a408dbf08336c75dab09d7e1a75663f6d02f5cbfadc99656b414"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RepoTags"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RepoDigests"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Parent"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sha256:71a676dd070f4b701c3272e566d84951362f1326ea07d5bbad119d1c4f6b3d02"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Comment"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Created"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-10-21T14:45:28.663079802Z"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Container"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b62810bb88264b6f9ae80c415e11f19729248c050401750bda597f935c482108"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ContainerConfig"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hostname"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b62810bb8826"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Domainname"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"User"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AttachStdin"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AttachStdout"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AttachStderr"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Tty"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OpenStdin"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StdinOnce"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Env"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Cmd"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#(nop) "')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CMD ['),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("/bin/sh"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("-c"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("echo "),n("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("hello world"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(']"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Image"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sha256:71a676dd070f4b701c3272e566d84951362f1326ea07d5bbad119d1c4f6b3d02"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Volumes"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WorkingDir"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Entrypoint"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OnBuild"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DockerVersion"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20.10.12"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Author"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hostname"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Domainname"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"User"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AttachStdin"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AttachStdout"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AttachStderr"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Tty"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OpenStdin"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StdinOnce"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Env"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Cmd"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo '),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("hello world"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Image"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sha256:71a676dd070f4b701c3272e566d84951362f1326ea07d5bbad119d1c4f6b3d02"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Volumes"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WorkingDir"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Entrypoint"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OnBuild"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Architecture"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"arm64"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Variant"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v8"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Os"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Size"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1411612")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VirtualSize"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1411612")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GraphDriver"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Data"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MergedDir"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/overlay2/1fd0a027cca34b60f52f9857f1cb3fce5c8e7562ad035a484a75f7232f8d13eb/merged"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UpperDir"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/overlay2/1fd0a027cca34b60f52f9857f1cb3fce5c8e7562ad035a484a75f7232f8d13eb/diff"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WorkDir"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/overlay2/1fd0a027cca34b60f52f9857f1cb3fce5c8e7562ad035a484a75f7232f8d13eb/work"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"overlay2"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RootFS"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layers"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Layers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sha256:468ad4d964cd60bde6271569ed2459b3cd52ee8a5a621f3f5fae86efa37e390c"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Metadata"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LastTagTime"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0001-01-01T00:00:00Z"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br")])]),n("p",[s._v("运行")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run e79c13b4d138\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"怎么编写正确、高效的-dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#怎么编写正确、高效的-dockerfile"}},[s._v("#")]),s._v(" 怎么编写正确、高效的 Dockerfile")]),s._v(" "),n("p",[n("strong",[s._v("第一条指令必须是"),n("code",[s._v("FROM")])]),s._v("，所以基础镜像的选择非常关键；如果关注的是镜像的安全和代销，那么一般会选择"),n("code",[s._v("Alpine")]),s._v("；如果关注的是应用的运行稳定性，那么可能会选择"),n("code",[s._v("Ubuntu、Debian、CentOS")])]),s._v(" "),n("div",{staticClass:"language-Dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[s._v("FORM alpine:3.15 # 选择alpine 镜像\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu:bionic # 选择ubuntu镜像")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("我们在本机上开发测试时会产生一些源码、配置等文件，需要打包进镜像里，这时可以使用 "),n("code",[s._v("COPY")]),s._v(" 命令，它的用法和 "),n("code",[s._v("Linux")]),s._v(" 的 "),n("code",[s._v("cp")]),s._v(" 差不多，不过拷贝的源文件必须是“"),n("strong",[s._v("构建上下文")]),s._v("”路径里的，不能随意指定文件。也就是说，如果要从本机向镜像拷贝文件，就必须把这些文件放到一个专门的目录，然后在 "),n("code",[s._v("docker build")]),s._v(" 里指定“构建上下文”到这个目录才行。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("COPY ./a.txt  /tmp/a.txt    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把构建上下文里的a.txt拷贝到镜像的/tmp目录")]),s._v("\nCOPY /etc/hosts  /tmp       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误！不能使用构建上下文之外的文件")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("接下来是一个"),n("code",[s._v("RUN")]),s._v("命令，它可以执行任意的"),n("code",[s._v("Shell")]),s._v("命令，比如更新系统、安装应用、下载文件、创建目录、编译程序等。实现任意的镜像构建步骤，非常灵活。")]),s._v(" "),n("p",[s._v("但是"),n("code",[s._v("Dockerfile")]),s._v("里指令只能是一行，所以所有的"),n("code",[s._v("RUN")]),s._v("指令会在每行末尾加上续行符"),n("code",[s._v("\\")]),s._v("，命令之间也是由"),n("code",[s._v("&&")]),s._v("来连接，这样保证逻辑上是一行。")]),s._v(" "),n("div",{staticClass:"language-Dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && apt-get install -y "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n        build-essential "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n        curl "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n        make "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n        unzip "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && cd /tmp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && curl -fSL xxx.tar.gz -o xxx.tar.gz"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && tar xzf xxx.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && cd xxx "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && ./config "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && make "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && make clean")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("我们如果觉得太长，可以使用上面的"),n("code",[s._v("COPY")]),s._v("命令，将内容全部写到一个"),n("code",[s._v(".sh")]),s._v("脚本里，使用"),n("code",[s._v("COPY")]),s._v("命令拷贝进去再进行执行。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("COPY setup.sh  /tmp/                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝脚本到/tmp目录")]),s._v("\n\nRUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x setup.sh "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加执行权限")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./setup.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" setup.sh    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行脚本然后再删除")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("code",[s._v("RUN")]),s._v(" 指令实际上就是 "),n("code",[s._v("Shell")]),s._v(" 编程，如果你对它有所了解，就应该知道它有变量的概念，可以实现参数化运行，这在 "),n("code",[s._v("Dockerfile")]),s._v(" 里也可以做到，需要使用两个指令 "),n("code",[s._v("ARG")]),s._v(" 和 "),n("code",[s._v("ENV")]),s._v("。")]),s._v(" "),n("p",[s._v("它们区别在于 "),n("code",[s._v("ARG")]),s._v(" 创建的变量只在镜像构建过程中可见，容器运行时不可见，而 "),n("code",[s._v("ENV")]),s._v(" 创建的变量不仅能够在构建镜像的过程中使用，在容器运行时也能够以环境变量的形式被应用程序使用。")]),s._v(" "),n("p",[s._v("使用"),n("code",[s._v("ARG")]),s._v("定义基础 镜像名称，和使用"),n("code",[s._v("ENV")]),s._v("来定义环境变量：")]),s._v(" "),n("div",{staticClass:"language-Dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" IMAGE_BASE="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" IMAGE_TAG="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alpine"')])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PATH="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PATH")]),s._v(":/tmp")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" DEBUG=OFF")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("还有一个重要的指令是 "),n("code",[s._v("EXPOSE")]),s._v("，它用来声明容器对外服务的端口号，对现在基于 "),n("code",[s._v("Node.js、Tomcat、Nginx、Go")]),s._v(" 等开发的微服务系统来说非常有用：")]),s._v(" "),n("p",[s._v(":::caution 注意")]),s._v(" "),n("p",[s._v("每个指令都会生成一个镜像层，所以 Dockerfile 里最好不要滥用指令，尽量精简合并，否则太多的层会导致镜像臃肿不堪。")]),s._v(" "),n("p",[s._v(":::")]),s._v(" "),n("hr"),s._v(" "),n("p",[n("code",[s._v("docker")]),s._v("也有不需要打包的东西，我们可以使用"),n("code",[s._v(".dockerignore")]),s._v("和"),n("code",[s._v(".gitignore")]),s._v("一样，排除那些不需要的文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# docker ignore\n*.swp # 排除以 .swp 结尾的文件\n*.sh # 排除以 .sh 结尾的文件\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("构建的时候一般使用"),n("code",[s._v("-f")]),s._v("来显式指定构建文件，如果省略这个参数则"),n("code",[s._v("docker build")]),s._v("会在当前目录下找名字是"),n("code",[s._v("Dockerfile")]),s._v("的文件，所以只有一个构建文件时，直接叫"),n("code",[s._v("Dockerfile")]),s._v("是最省事的。")]),s._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("ol",[n("li",[s._v("创建镜像需要编写 Dockerfile，写清楚创建镜像的步骤，每个指令都会生成一个 "),n("code",[s._v("Layer")]),s._v("。")]),s._v(" "),n("li",[n("code",[s._v("Dockerfile")]),s._v(" 里，第一个指令必须是 "),n("code",[s._v("FROM")]),s._v("，用来选择基础镜像，常用的有 "),n("code",[s._v("Alpine")]),s._v("、"),n("code",[s._v("Ubuntu")]),s._v(" 等。其他常用的指令有："),n("code",[s._v("COPY")]),s._v("、"),n("code",[s._v("RUN")]),s._v("、"),n("code",[s._v("EXPOSE")]),s._v("，分别是拷贝文件，运行 "),n("code",[s._v("Shell")]),s._v(" 命令，声明服务端口号。")]),s._v(" "),n("li",[n("code",[s._v("docker build")]),s._v(" 需要用 -f 来指定 "),n("code",[s._v("Dockerfile")]),s._v("，如果不指定就使用当前目录下名字是“"),n("code",[s._v("Dockerfile")]),s._v("”的文件。")]),s._v(" "),n("li",[n("code",[s._v("docker build")]),s._v(" 需要指定“构建上下文”，其中的文件会打包上传到 "),n("code",[s._v("Docker daemon")]),s._v("，所以尽量不要在“构建上下文”中存放多余的文件。")]),s._v(" "),n("li",[s._v("创建镜像的时候应当尽量使用 -t 参数，为镜像起一个有意义的名字，方便管理。")])]),s._v(" "),n("h2",{attrs:{id:"案例-demo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例-demo"}},[s._v("#")]),s._v(" 案例 demo")]),s._v(" "),n("div",{staticClass:"language-Dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dockerfile")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t ngx-app .")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t ngx-app:1.0 .")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" IMAGE_BASE="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" IMAGE_TAG="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.21-alpine"')])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${IMAGE_BASE}")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${IMAGE_TAG}")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./default.conf /etc/nginx/conf.d/")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" cd /usr/share/nginx/html "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello nginx"')]),s._v(" > a.txt")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8081 8082 8083")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("基本意思就是构建一个"),n("code",[s._v("nginx")]),s._v("轻量级镜像，并配置一个默认配置，简单写了一个"),n("code",[s._v("htm")]),s._v("，并暴露一些端口。")])])}),[],!1,null,null,null);a.default=e.exports}}]);