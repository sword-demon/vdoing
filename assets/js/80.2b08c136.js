(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{521:function(s,n,a){"use strict";a.r(n);var t=a(16),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"casbin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#casbin"}},[s._v("#")]),s._v(" Casbin")]),s._v(" "),a("blockquote",[a("p",[s._v("Casbin 是一个强大的、高效的开源访问控制框架，其权限管理机制支持多种访问控制模型。")])]),s._v(" "),a("p",[s._v("文档地址："),a("a",{attrs:{href:"https://casbin.org/docs/zh-CN/overview",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://casbin.org/docs/zh-CN/overview"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"新建项目-gcasbin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建项目-gcasbin"}},[s._v("#")]),s._v(" 新建项目 gcasbin")]),s._v(" "),a("p",[s._v("新建目录"),a("code",[s._v("resources")])]),s._v(" "),a("p",[s._v("在里面新建一个"),a("code",[s._v("model.conf")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[request_definition]\nr = sub, obj, act\n\n[policy_definition]\np = sub, obj, act\n\n[role_definition]\ng = _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = g(r.sub, p.sub) && r.obj == p.obj && r.act == p.act\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("工作原理："),a("a",{attrs:{href:"https://casbin.org/docs/zh-CN/how-it-works",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://casbin.org/docs/zh-CN/how-it-works"),a("OutboundLink")],1)]),s._v(" "),a("ol",[a("li",[a("p",[a("code",[s._v("request_definition")]),s._v("：请求定义")]),s._v(" "),a("p",[a("code",[s._v("r = sub, obj, act")]),s._v("，必须传这 3 段而且得和策略进行关联")]),s._v(" "),a("ul",[a("li",[s._v("访问实体："),a("code",[s._v("subject")])]),s._v(" "),a("li",[s._v("访问资源："),a("code",[s._v("object")])]),s._v(" "),a("li",[s._v("访问方法："),a("code",[s._v("action")])])]),s._v(" "),a("p",[s._v("譬如：xxx 这个用户要访问"),a("code",[s._v("/users")]),s._v("并且是"),a("code",[s._v("GET")]),s._v("请求，则写成")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("xxx sub")])]),s._v(" "),a("li",[a("code",[s._v("/users obj")])]),s._v(" "),a("li",[a("code",[s._v("GET act")])])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("policy_definition")]),s._v("：策略定义，也叫模型定义")]),s._v(" "),a("p",[a("code",[s._v("p = sub, obj, act")])]),s._v(" "),a("p",[s._v("定义和上述一样")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("role_definition")]),s._v("：角色定义")]),s._v(" "),a("p",[a("code",[s._v("g=_,_")]),s._v("："),a("code",[s._v("_,_")]),s._v("表示角色继承关系的前项和后项，即前项继承后项角色的权限")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("policy_effect")]),s._v("：策略的生效范围")]),s._v(" "),a("p",[a("code",[s._v("e = some(where (p.eft == allow))")]),s._v("，如果存在任意一个决策结果为"),a("code",[s._v("allow")]),s._v("的匹配规则，则最终决策结果为"),a("code",[s._v("allow")]),s._v("，"),a("code",[s._v("p.eft")]),s._v("就是决策结果。")]),s._v(" "),a("p",[s._v("示例："),a("code",[s._v("!some(where (p.eft == deny))")]),s._v("表示任何一个决策结果都不能是"),a("code",[s._v("deny")])])])]),s._v(" "),a("p",[s._v("通过"),a("code",[s._v("matchers")]),s._v("将上面进行关联")]),s._v(" "),a("p",[s._v("再新建一个"),a("code",[s._v("p.csv")]),s._v("，这是一个策略，一般来说实际开发，是放在数据库里的，特别少的可以使用文件配置，这里只是个简单模拟")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("p, member, /depts, GET\np, member, /depts/:id, GET\n\np, admin, /depts, POST\np, admin, /depts/:id, PUT\np, admin, /depts/:id, DELETE\n\ng, admin, member\ng, wujie, admin\ng, lisi, member\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"demo-代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo-代码"}},[s._v("#")]),s._v(" demo 代码")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/casbin/casbin"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tsub "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lisi"')]),s._v("\n\tobj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/depts"')]),s._v("\n\tact "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),s._v("\n\te "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" casbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewEnforcer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resources/model.conf"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resources/p.csv"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 决策是否可以访问")]),s._v("\n\tok "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Enforce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" act"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ok "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"运行通过"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("从上面策略来看，用户"),a("code",[s._v("lisi")]),s._v("继承"),a("code",[s._v("member")]),s._v("，而"),a("code",[s._v("member")]),s._v("对"),a("code",[s._v("/depts")]),s._v("的"),a("code",[s._v("GET")]),s._v("请求时有的，所以会执行运行通过")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("➜  gcasbin go run main.go\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/10/12 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":21:27 运行通过\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如果"),a("code",[s._v("act")]),s._v("换成"),a("code",[s._v("POST")]),s._v("，那就不能通过；如果"),a("code",[s._v("sub")]),s._v("换成"),a("code",[s._v("wujie")]),s._v("，那么无论是"),a("code",[s._v("GET")]),s._v("请求还是"),a("code",[s._v("POST")]),s._v("请求都能进行访问。")])])}),[],!1,null,null,null);n.default=e.exports}}]);