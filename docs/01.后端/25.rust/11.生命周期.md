---
title: ç”Ÿå‘½å‘¨æœŸ
date: 2022-11-06 16:47:49
permalink: /pages/16139c/
categories:
    - åç«¯
    - rust
tags:
    - lifecycle
---

# ç”Ÿå‘½å‘¨æœŸ

## å…¥é—¨

ç®€å•ä»£ç 

```rust
fn main() {
    let myage;
    {
        let age = 19;
        myage = &age;
    }
    println!("{}", myage);
}
```

> é—®é¢˜ï¼š
>
> `age` does not live long enough
> borrowed value does not live long enoughrustc[E0597](https://doc.rust-lang.org/error-index.html#E0597)
>
> main.rs(12, 5): `age` dropped here while still borrowed
>
> main.rs(13, 20): borrow later used here`

è¯´æ˜`age`åªåœ¨è¿™ä¸ªä»£ç å—é‡Œå­˜æ´»ï¼Œå¦‚æœé€šè¿‡å¼•ç”¨è¿›è¡Œâ€œæ‹¿â€å‡ºå»è°ƒç”¨ï¼Œåˆ™æ— æ³•ä½¿ç”¨ã€‚æ‰€ä»¥`rust`ä¼šæœ‰ä¸€ä¸ªå†…ç½®çš„ç”Ÿå‘½å‘¨æœŸæ£€æµ‹ã€‚

åˆ¤æ–­è§„åˆ™ï¼š**myage æ‰€å¤„çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¼•ç”¨äº†æ¯”ä»–å°çš„ç”Ÿå‘½å‘¨æœŸé‡Œçš„ age æ•°æ®**ï¼Œä¼šè®¤ä¸ºä½ çš„ç”Ÿå‘½å‘¨æœŸä»£ç æœ‰è¯¯ï¼Œä¸èƒ½ç¼–è¯‘ã€‚

<!-- more -->

### demo2ï¼šæ¯”è¾ƒå¤§å°çš„å‡½æ•°

```rust
mod api;
mod models;

fn max(a: i32, b: i32) -> i32 {
    if a > b {
        a
    } else {
        b
    }
}

fn main() {
    let a = 12;
    let b = 21;
    println!("æœ€å¤§å€¼æ˜¯: {}", max(a, b));
}

```

æˆ‘ä»¬æ¥æ¢æˆå¼•ç”¨æ–¹å¼ï¼Œå°±å¾—å‘Šè¯‰`max`å‡½æ•°ï¼Œä½ è°ƒç”¨çš„`a`å’Œ`b`çš„å¼•ç”¨å±äºå“ªä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå®šä¹‰æ–¹å¼æ˜¯ä¸€ä¸ªå•å¼•å·åŠ ä½ è‡ªå·±å®šä¹‰çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçš„åç§°ï¼Œæ¯”å¦‚ï¼š`'a`ï¼Œåªæœ‰å·¦ä¾§ä¸€ä¸ªå•å¼•å·ã€‚

```rust
fn max<'a>(a: &'a i32, b: &'a i32) -> &'a i32 {
    if a > b {
        a
    } else {
        b
    }
}

fn main() {
    let a = 12;
    let b = 21;
    println!("æœ€å¤§å€¼æ˜¯: {}", max(&a, &b));
}
```

è¿™é‡Œçš„`'a`ï¼Œé‡Œé¢çš„ a ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è®° ğŸ“Œ è€Œå·²ï¼Œä¸ç”¨è¿‡å¤šåœ¨æ„å®ƒå«ä»€ä¹ˆï¼Œè€Œæ˜¯è¦åœ¨æ„å®ƒè¿™é‡Œè¦åŠ ã€‚

## åœ¨ struct ä¸­ä½¿ç”¨å¼•ç”¨å±æ€§

```rust
#[derive(Debug)]
struct User<'a> {
    id: &'a i32,
}

fn main() {
    let mut id = 11;
    let u = User { id: &id };
    println!("{:?}", u);
    id = 107;
    println!("{:?}", id);
}

```

ä¸Šè¿°è¿™æ ·æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯æ”¹æˆè¿™æ ·

```rust
#[derive(Debug)]
struct User<'a> {
    id: &'a i32,
}

fn main() {
    let mut id = 11; // å¥½æ¯”æ˜¯æˆ‘çš„ä¸œè¥¿
    let u = User { id: &id }; // ä¸œè¥¿è¢« u å€Ÿèµ°äº†

    id = 107; // ä¸èƒ½ä½¿ç”¨
    println!("{:?}", u); // è¿˜åœ¨ u ï¼Œæ²¡è¿˜ï¼Œè¿™ä¸ªä»£ç ä¸‹é¢æ²¡æœ‰ä»»ä½•åœ°æ–¹ä½¿ç”¨u å°±å¯ä»¥ç»§ç»­ä½¿ç”¨ id
}

```

```rust
#[derive(Debug)]
struct User<'a> {
    id: &'a i32,
}

fn main() {
    let mut id = 11; // å¥½æ¯”æ˜¯æˆ‘çš„ä¸œè¥¿
    let u = User { id: &id }; // ä¸œè¥¿è¢« u å€Ÿèµ°äº†

    id = 107; // ä¸èƒ½ä½¿ç”¨
    println!("{:?}", id); // å¯ä»¥ç»§ç»­ä½¿ç”¨id
}
```

## &str

è®°å¾—å‰é¢å†™è¿™ä¸ªçš„æ—¶å€™ï¼Œæ€»ä¼šåŠ ä¸Šä¸€ä¸ª`&'static str`ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯è·Ÿç”Ÿå‘½å‘¨æœŸæœ‰å…³ã€‚

```rust
let name = "wujie";
```

:::tip æ³¨æ„

å®ƒçš„æœ¬è´¨æ˜¯`str`ï¼Œè€Œä¸”æ˜¯è¢«ä¿å­˜åœ¨â€œäºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„â€ï¼Œä½¿ç”¨çš„æ—¶å€™ä½¿ç”¨å¼•ç”¨çš„æ–¹å¼æ¥å€Ÿç”¨å®ƒã€‚å› æ­¤å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯`static`ï¼Œ`static`ç”Ÿå‘½å‘¨æœŸè´¯ç©¿äºæ•´ä¸ªç¨‹åºï¼Œå› æ­¤ä¸¥æ ¼æ¥è¯´å«**é™æ€ç”Ÿå­˜æœŸ**ã€‚

:::

```rust
fn show_name(name: &'static str) -> &'static str {
    name
}

fn main() {
    let name = "lisi";
    show_name(name);
}
```

æˆ–è€…

```rust
fn show_name<'a>(name: &'a str) -> &'a str {
    name
}
```

åªè¦`name`çš„ç”Ÿå‘½å‘¨æœŸä¸å¤§äºè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸå³å¯ã€‚
