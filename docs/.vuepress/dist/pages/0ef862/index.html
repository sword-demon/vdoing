<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>drf学习 | wxvirus</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/icon.png">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="年轻的后端，学习ing">
    <meta name="无解" content="个人学习博客和笔记">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.3aa0083c.css" as="style"><link rel="preload" href="/assets/js/app.bac3fc37.js" as="script"><link rel="preload" href="/assets/js/2.5e51705b.js" as="script"><link rel="preload" href="/assets/js/16.f971791d.js" as="script"><link rel="prefetch" href="/assets/js/10.90c765a3.js"><link rel="prefetch" href="/assets/js/100.c7caefb0.js"><link rel="prefetch" href="/assets/js/101.dde3d0e4.js"><link rel="prefetch" href="/assets/js/102.27931644.js"><link rel="prefetch" href="/assets/js/103.10c741cd.js"><link rel="prefetch" href="/assets/js/104.6db280d9.js"><link rel="prefetch" href="/assets/js/105.396d2324.js"><link rel="prefetch" href="/assets/js/106.9e6ed018.js"><link rel="prefetch" href="/assets/js/107.f9d1f955.js"><link rel="prefetch" href="/assets/js/108.df31796f.js"><link rel="prefetch" href="/assets/js/109.27dabfa9.js"><link rel="prefetch" href="/assets/js/11.c930365d.js"><link rel="prefetch" href="/assets/js/110.7a256163.js"><link rel="prefetch" href="/assets/js/111.5cd339b0.js"><link rel="prefetch" href="/assets/js/112.c97644d7.js"><link rel="prefetch" href="/assets/js/113.8aa38706.js"><link rel="prefetch" href="/assets/js/114.5681cce8.js"><link rel="prefetch" href="/assets/js/115.d30d5e25.js"><link rel="prefetch" href="/assets/js/116.bbe9f012.js"><link rel="prefetch" href="/assets/js/117.51717794.js"><link rel="prefetch" href="/assets/js/118.8644824e.js"><link rel="prefetch" href="/assets/js/119.f998b49f.js"><link rel="prefetch" href="/assets/js/12.971b95e8.js"><link rel="prefetch" href="/assets/js/120.d50249b9.js"><link rel="prefetch" href="/assets/js/121.9068c094.js"><link rel="prefetch" href="/assets/js/122.30d1b92d.js"><link rel="prefetch" href="/assets/js/123.747be88c.js"><link rel="prefetch" href="/assets/js/124.c917ec75.js"><link rel="prefetch" href="/assets/js/125.864c3469.js"><link rel="prefetch" href="/assets/js/126.06311686.js"><link rel="prefetch" href="/assets/js/127.67fde8fa.js"><link rel="prefetch" href="/assets/js/128.661d78f6.js"><link rel="prefetch" href="/assets/js/129.b60d34ea.js"><link rel="prefetch" href="/assets/js/13.fe103bbb.js"><link rel="prefetch" href="/assets/js/130.490f5bd8.js"><link rel="prefetch" href="/assets/js/131.7ac795b0.js"><link rel="prefetch" href="/assets/js/132.cbaa86c1.js"><link rel="prefetch" href="/assets/js/133.4ebf9585.js"><link rel="prefetch" href="/assets/js/134.90db0d9d.js"><link rel="prefetch" href="/assets/js/135.b3aa57a9.js"><link rel="prefetch" href="/assets/js/136.ffdab3cb.js"><link rel="prefetch" href="/assets/js/137.99c47704.js"><link rel="prefetch" href="/assets/js/138.c6d154fe.js"><link rel="prefetch" href="/assets/js/139.06398496.js"><link rel="prefetch" href="/assets/js/14.1ce65571.js"><link rel="prefetch" href="/assets/js/140.facaf060.js"><link rel="prefetch" href="/assets/js/141.67d1f4da.js"><link rel="prefetch" href="/assets/js/142.066ce4b8.js"><link rel="prefetch" href="/assets/js/143.520d79e9.js"><link rel="prefetch" href="/assets/js/144.bf82a89d.js"><link rel="prefetch" href="/assets/js/145.98a5d359.js"><link rel="prefetch" href="/assets/js/146.99f3227a.js"><link rel="prefetch" href="/assets/js/147.211c26a5.js"><link rel="prefetch" href="/assets/js/148.f7d81ad3.js"><link rel="prefetch" href="/assets/js/149.6fea4245.js"><link rel="prefetch" href="/assets/js/15.76c907e4.js"><link rel="prefetch" href="/assets/js/150.79a878e9.js"><link rel="prefetch" href="/assets/js/151.90895cb7.js"><link rel="prefetch" href="/assets/js/152.cf4ff236.js"><link rel="prefetch" href="/assets/js/153.e406000f.js"><link rel="prefetch" href="/assets/js/154.f72b6691.js"><link rel="prefetch" href="/assets/js/155.1f099435.js"><link rel="prefetch" href="/assets/js/156.fd162397.js"><link rel="prefetch" href="/assets/js/157.28105e8a.js"><link rel="prefetch" href="/assets/js/158.b6b5a458.js"><link rel="prefetch" href="/assets/js/159.d0c6a1fd.js"><link rel="prefetch" href="/assets/js/160.74cd630b.js"><link rel="prefetch" href="/assets/js/161.b172f3a2.js"><link rel="prefetch" href="/assets/js/162.3792d853.js"><link rel="prefetch" href="/assets/js/163.8fdcab36.js"><link rel="prefetch" href="/assets/js/164.7d9f9ed5.js"><link rel="prefetch" href="/assets/js/165.81fa3966.js"><link rel="prefetch" href="/assets/js/166.82765ea7.js"><link rel="prefetch" href="/assets/js/167.89cc739b.js"><link rel="prefetch" href="/assets/js/168.1617b42e.js"><link rel="prefetch" href="/assets/js/169.de0f177f.js"><link rel="prefetch" href="/assets/js/17.038ff3b8.js"><link rel="prefetch" href="/assets/js/170.dace701c.js"><link rel="prefetch" href="/assets/js/171.e4813402.js"><link rel="prefetch" href="/assets/js/172.d8b5bbd2.js"><link rel="prefetch" href="/assets/js/173.b7122e3b.js"><link rel="prefetch" href="/assets/js/174.5d760dbf.js"><link rel="prefetch" href="/assets/js/175.bd6c5b63.js"><link rel="prefetch" href="/assets/js/176.e29389a3.js"><link rel="prefetch" href="/assets/js/177.f0d6d218.js"><link rel="prefetch" href="/assets/js/178.36fc2aa2.js"><link rel="prefetch" href="/assets/js/179.38563c13.js"><link rel="prefetch" href="/assets/js/18.7140ae95.js"><link rel="prefetch" href="/assets/js/180.7fcf330b.js"><link rel="prefetch" href="/assets/js/181.29b5bb21.js"><link rel="prefetch" href="/assets/js/182.3322f8bd.js"><link rel="prefetch" href="/assets/js/183.940f20ae.js"><link rel="prefetch" href="/assets/js/184.a57562b0.js"><link rel="prefetch" href="/assets/js/185.77cd5566.js"><link rel="prefetch" href="/assets/js/186.116cbd75.js"><link rel="prefetch" href="/assets/js/187.c72d6e5e.js"><link rel="prefetch" href="/assets/js/188.0991a2f4.js"><link rel="prefetch" href="/assets/js/189.7bd24939.js"><link rel="prefetch" href="/assets/js/19.d7837ce4.js"><link rel="prefetch" href="/assets/js/190.83239fb1.js"><link rel="prefetch" href="/assets/js/191.dfcb7024.js"><link rel="prefetch" href="/assets/js/192.20bfeb60.js"><link rel="prefetch" href="/assets/js/193.96189329.js"><link rel="prefetch" href="/assets/js/194.734fb431.js"><link rel="prefetch" href="/assets/js/195.26e64eda.js"><link rel="prefetch" href="/assets/js/196.bf2a6a3f.js"><link rel="prefetch" href="/assets/js/197.9712169e.js"><link rel="prefetch" href="/assets/js/198.c282f165.js"><link rel="prefetch" href="/assets/js/199.e94641de.js"><link rel="prefetch" href="/assets/js/20.3f4b397e.js"><link rel="prefetch" href="/assets/js/200.138e5e34.js"><link rel="prefetch" href="/assets/js/201.9db518cc.js"><link rel="prefetch" href="/assets/js/202.410fd91c.js"><link rel="prefetch" href="/assets/js/203.cd09bafe.js"><link rel="prefetch" href="/assets/js/204.acface42.js"><link rel="prefetch" href="/assets/js/205.8f4f7376.js"><link rel="prefetch" href="/assets/js/206.71033967.js"><link rel="prefetch" href="/assets/js/207.8169cdad.js"><link rel="prefetch" href="/assets/js/208.ae8f6049.js"><link rel="prefetch" href="/assets/js/209.1baf363c.js"><link rel="prefetch" href="/assets/js/21.f461441c.js"><link rel="prefetch" href="/assets/js/210.fbe87d24.js"><link rel="prefetch" href="/assets/js/211.d870a78f.js"><link rel="prefetch" href="/assets/js/212.ebe0e3aa.js"><link rel="prefetch" href="/assets/js/213.a406f292.js"><link rel="prefetch" href="/assets/js/214.5a7bb0e2.js"><link rel="prefetch" href="/assets/js/215.a2be63fd.js"><link rel="prefetch" href="/assets/js/216.37dbf804.js"><link rel="prefetch" href="/assets/js/217.dd06a13b.js"><link rel="prefetch" href="/assets/js/218.4d34e080.js"><link rel="prefetch" href="/assets/js/219.e27ef80e.js"><link rel="prefetch" href="/assets/js/22.2f261478.js"><link rel="prefetch" href="/assets/js/220.08a9e308.js"><link rel="prefetch" href="/assets/js/221.ddce756b.js"><link rel="prefetch" href="/assets/js/222.805f4f7e.js"><link rel="prefetch" href="/assets/js/223.6d035625.js"><link rel="prefetch" href="/assets/js/224.4c37b842.js"><link rel="prefetch" href="/assets/js/225.87c61d5e.js"><link rel="prefetch" href="/assets/js/226.5f6d1b09.js"><link rel="prefetch" href="/assets/js/227.ddfb0225.js"><link rel="prefetch" href="/assets/js/228.e93b1cb7.js"><link rel="prefetch" href="/assets/js/229.9e4ff7c5.js"><link rel="prefetch" href="/assets/js/23.215d0d3d.js"><link rel="prefetch" href="/assets/js/230.57141bc7.js"><link rel="prefetch" href="/assets/js/231.861eadcf.js"><link rel="prefetch" href="/assets/js/232.6355c4f7.js"><link rel="prefetch" href="/assets/js/233.c54857bf.js"><link rel="prefetch" href="/assets/js/234.226e2cd4.js"><link rel="prefetch" href="/assets/js/235.503e4403.js"><link rel="prefetch" href="/assets/js/236.8deb7bb6.js"><link rel="prefetch" href="/assets/js/237.eca6d73e.js"><link rel="prefetch" href="/assets/js/238.de32b43b.js"><link rel="prefetch" href="/assets/js/239.27610d40.js"><link rel="prefetch" href="/assets/js/24.4993714d.js"><link rel="prefetch" href="/assets/js/240.3423c8dc.js"><link rel="prefetch" href="/assets/js/241.d5e42a85.js"><link rel="prefetch" href="/assets/js/242.eb857fa5.js"><link rel="prefetch" href="/assets/js/243.06f45458.js"><link rel="prefetch" href="/assets/js/244.e4f8dca3.js"><link rel="prefetch" href="/assets/js/245.b783d0cf.js"><link rel="prefetch" href="/assets/js/246.b087a65c.js"><link rel="prefetch" href="/assets/js/247.76d4fdf2.js"><link rel="prefetch" href="/assets/js/248.2e03f4a5.js"><link rel="prefetch" href="/assets/js/249.063d1a17.js"><link rel="prefetch" href="/assets/js/25.693aae76.js"><link rel="prefetch" href="/assets/js/250.62846b25.js"><link rel="prefetch" href="/assets/js/251.0fc895c5.js"><link rel="prefetch" href="/assets/js/252.5ffcab12.js"><link rel="prefetch" href="/assets/js/253.e8936337.js"><link rel="prefetch" href="/assets/js/254.7c71bcff.js"><link rel="prefetch" href="/assets/js/255.52bf2fa5.js"><link rel="prefetch" href="/assets/js/256.570acc85.js"><link rel="prefetch" href="/assets/js/257.2535c506.js"><link rel="prefetch" href="/assets/js/258.94250e64.js"><link rel="prefetch" href="/assets/js/259.f51a6931.js"><link rel="prefetch" href="/assets/js/26.0f012fd3.js"><link rel="prefetch" href="/assets/js/260.fc183175.js"><link rel="prefetch" href="/assets/js/261.607774e8.js"><link rel="prefetch" href="/assets/js/262.09c4fb64.js"><link rel="prefetch" href="/assets/js/263.3789ae57.js"><link rel="prefetch" href="/assets/js/264.f3d53de0.js"><link rel="prefetch" href="/assets/js/265.9c1316d0.js"><link rel="prefetch" href="/assets/js/266.e6d0de4c.js"><link rel="prefetch" href="/assets/js/267.e546beb2.js"><link rel="prefetch" href="/assets/js/268.bd5e9698.js"><link rel="prefetch" href="/assets/js/269.97581ef3.js"><link rel="prefetch" href="/assets/js/27.574f6c41.js"><link rel="prefetch" href="/assets/js/270.9b3ca42c.js"><link rel="prefetch" href="/assets/js/271.983863d0.js"><link rel="prefetch" href="/assets/js/272.c1767c31.js"><link rel="prefetch" href="/assets/js/273.8b8f01cb.js"><link rel="prefetch" href="/assets/js/274.0e605fb8.js"><link rel="prefetch" href="/assets/js/275.e6b243ee.js"><link rel="prefetch" href="/assets/js/276.39e6ec9e.js"><link rel="prefetch" href="/assets/js/277.80e531ca.js"><link rel="prefetch" href="/assets/js/278.2a83681d.js"><link rel="prefetch" href="/assets/js/279.c3c4ce4f.js"><link rel="prefetch" href="/assets/js/28.f5d79423.js"><link rel="prefetch" href="/assets/js/280.9f9e370f.js"><link rel="prefetch" href="/assets/js/281.798fd47a.js"><link rel="prefetch" href="/assets/js/282.8bf7a2a5.js"><link rel="prefetch" href="/assets/js/283.3f45c5fa.js"><link rel="prefetch" href="/assets/js/284.08a9a8a3.js"><link rel="prefetch" href="/assets/js/285.b5ebcc58.js"><link rel="prefetch" href="/assets/js/286.ad860c88.js"><link rel="prefetch" href="/assets/js/287.f7fa4604.js"><link rel="prefetch" href="/assets/js/288.f82a2d9e.js"><link rel="prefetch" href="/assets/js/289.ff2bdb51.js"><link rel="prefetch" href="/assets/js/29.e7d78e5a.js"><link rel="prefetch" href="/assets/js/290.5289e10a.js"><link rel="prefetch" href="/assets/js/291.2de1168b.js"><link rel="prefetch" href="/assets/js/292.17f9a2b2.js"><link rel="prefetch" href="/assets/js/293.0f5b2903.js"><link rel="prefetch" href="/assets/js/294.8d061a33.js"><link rel="prefetch" href="/assets/js/295.f2c1f791.js"><link rel="prefetch" href="/assets/js/296.998deef1.js"><link rel="prefetch" href="/assets/js/297.68712371.js"><link rel="prefetch" href="/assets/js/298.118ec37b.js"><link rel="prefetch" href="/assets/js/299.1f630b42.js"><link rel="prefetch" href="/assets/js/3.7d1865eb.js"><link rel="prefetch" href="/assets/js/30.e3d93df2.js"><link rel="prefetch" href="/assets/js/300.52dfddfb.js"><link rel="prefetch" href="/assets/js/301.8e24a037.js"><link rel="prefetch" href="/assets/js/302.4254d1f1.js"><link rel="prefetch" href="/assets/js/303.74d0b4aa.js"><link rel="prefetch" href="/assets/js/304.95cf55e4.js"><link rel="prefetch" href="/assets/js/305.8ce647c6.js"><link rel="prefetch" href="/assets/js/306.4caf4cc8.js"><link rel="prefetch" href="/assets/js/307.8a07edc9.js"><link rel="prefetch" href="/assets/js/308.c781baf2.js"><link rel="prefetch" href="/assets/js/309.eb9c84a7.js"><link rel="prefetch" href="/assets/js/31.0194083b.js"><link rel="prefetch" href="/assets/js/310.7cf2822f.js"><link rel="prefetch" href="/assets/js/32.a9e1a741.js"><link rel="prefetch" href="/assets/js/33.bc2f4cf6.js"><link rel="prefetch" href="/assets/js/34.d6d8bc1e.js"><link rel="prefetch" href="/assets/js/35.4df678c2.js"><link rel="prefetch" href="/assets/js/36.bf935c73.js"><link rel="prefetch" href="/assets/js/37.a59fa60b.js"><link rel="prefetch" href="/assets/js/38.83a7d5bd.js"><link rel="prefetch" href="/assets/js/39.2e436e52.js"><link rel="prefetch" href="/assets/js/4.43e2f670.js"><link rel="prefetch" href="/assets/js/40.9fb1ae52.js"><link rel="prefetch" href="/assets/js/41.1e2316ba.js"><link rel="prefetch" href="/assets/js/42.5192856d.js"><link rel="prefetch" href="/assets/js/43.627b7449.js"><link rel="prefetch" href="/assets/js/44.0a670f1d.js"><link rel="prefetch" href="/assets/js/45.23f28dde.js"><link rel="prefetch" href="/assets/js/46.aaacef06.js"><link rel="prefetch" href="/assets/js/47.31928596.js"><link rel="prefetch" href="/assets/js/48.adc0260f.js"><link rel="prefetch" href="/assets/js/49.088c9284.js"><link rel="prefetch" href="/assets/js/5.de8a5401.js"><link rel="prefetch" href="/assets/js/50.e8e07e40.js"><link rel="prefetch" href="/assets/js/51.0d184529.js"><link rel="prefetch" href="/assets/js/52.3230648d.js"><link rel="prefetch" href="/assets/js/53.20ca7ad4.js"><link rel="prefetch" href="/assets/js/54.0a8a6892.js"><link rel="prefetch" href="/assets/js/55.5111fb82.js"><link rel="prefetch" href="/assets/js/56.02bfd7ea.js"><link rel="prefetch" href="/assets/js/57.4d17cf51.js"><link rel="prefetch" href="/assets/js/58.fe4d42b8.js"><link rel="prefetch" href="/assets/js/59.ff944f7a.js"><link rel="prefetch" href="/assets/js/6.34e19614.js"><link rel="prefetch" href="/assets/js/60.a25af074.js"><link rel="prefetch" href="/assets/js/61.2fd285f7.js"><link rel="prefetch" href="/assets/js/62.bbd0c292.js"><link rel="prefetch" href="/assets/js/63.9bf6878e.js"><link rel="prefetch" href="/assets/js/64.d1683054.js"><link rel="prefetch" href="/assets/js/65.c86d97f6.js"><link rel="prefetch" href="/assets/js/66.ef78c1a9.js"><link rel="prefetch" href="/assets/js/67.391ceeff.js"><link rel="prefetch" href="/assets/js/68.1217e8b7.js"><link rel="prefetch" href="/assets/js/69.456facd3.js"><link rel="prefetch" href="/assets/js/7.5df6473c.js"><link rel="prefetch" href="/assets/js/70.5bd9bd8e.js"><link rel="prefetch" href="/assets/js/71.33e0edcc.js"><link rel="prefetch" href="/assets/js/72.a1aea175.js"><link rel="prefetch" href="/assets/js/73.4c9e0bd1.js"><link rel="prefetch" href="/assets/js/74.6b078a5a.js"><link rel="prefetch" href="/assets/js/75.85512114.js"><link rel="prefetch" href="/assets/js/76.52f6f133.js"><link rel="prefetch" href="/assets/js/77.245eb958.js"><link rel="prefetch" href="/assets/js/78.35df01fe.js"><link rel="prefetch" href="/assets/js/79.c9ede502.js"><link rel="prefetch" href="/assets/js/8.b57e2b78.js"><link rel="prefetch" href="/assets/js/80.6172cd95.js"><link rel="prefetch" href="/assets/js/81.e80ad37f.js"><link rel="prefetch" href="/assets/js/82.2a59e77c.js"><link rel="prefetch" href="/assets/js/83.52f31375.js"><link rel="prefetch" href="/assets/js/84.64ba1937.js"><link rel="prefetch" href="/assets/js/85.1edd3a39.js"><link rel="prefetch" href="/assets/js/86.ee34362c.js"><link rel="prefetch" href="/assets/js/87.f73a37cb.js"><link rel="prefetch" href="/assets/js/88.a36a6ecd.js"><link rel="prefetch" href="/assets/js/89.ac63074d.js"><link rel="prefetch" href="/assets/js/9.6a956ad2.js"><link rel="prefetch" href="/assets/js/90.e3e0ae4e.js"><link rel="prefetch" href="/assets/js/91.cbf22f87.js"><link rel="prefetch" href="/assets/js/92.8d588841.js"><link rel="prefetch" href="/assets/js/93.92630a69.js"><link rel="prefetch" href="/assets/js/94.e65685e6.js"><link rel="prefetch" href="/assets/js/95.944e95e3.js"><link rel="prefetch" href="/assets/js/96.f444546f.js"><link rel="prefetch" href="/assets/js/97.36555392.js"><link rel="prefetch" href="/assets/js/98.93266ed7.js"><link rel="prefetch" href="/assets/js/99.a88a465d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3aa0083c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/icon.png" alt="wxvirus" class="logo"> <span class="site-name can-hide">wxvirus</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>PHP文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a09ce1/" class="nav-link">PHP设计模式</a></li></ul></li><li class="dropdown-item"><h4>Go文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1be6f5/" class="nav-link">Go语言学习</a></li></ul></li><li class="dropdown-item"><h4>Python文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0ef862/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Python</a></li></ul></li><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/java/" class="nav-link">《Java》</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/ui/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/7601f3/" class="nav-link">JS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/df7058/" class="nav-link">刷题</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/9d0e8f/" class="nav-link">算法学习</a></li><li class="dropdown-item"><!----> <a href="/pages/8f006a/" class="nav-link">架构设计</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/sword-demon" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpeg"> <div class="blogger-info"><h3>无解的lifecycle</h3> <span>let today = new Beginning()</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>PHP文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a09ce1/" class="nav-link">PHP设计模式</a></li></ul></li><li class="dropdown-item"><h4>Go文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1be6f5/" class="nav-link">Go语言学习</a></li></ul></li><li class="dropdown-item"><h4>Python文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0ef862/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Python</a></li></ul></li><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/java/" class="nav-link">《Java》</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/ui/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/7601f3/" class="nav-link">JS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/df7058/" class="nav-link">刷题</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/9d0e8f/" class="nav-link">算法学习</a></li><li class="dropdown-item"><!----> <a href="/pages/8f006a/" class="nav-link">架构设计</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/sword-demon" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C&amp;C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Python</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/0ef862/" aria-current="page" class="active sidebar-link">drf学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0ef862/#快速上手" class="sidebar-link">快速上手</a></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#请求数据的封装" class="sidebar-link">请求数据的封装</a></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#版本管理" class="sidebar-link">版本管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0ef862/#get请求获取" class="sidebar-link">GET请求获取</a></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#省事教程" class="sidebar-link">省事教程</a></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#url路径传递" class="sidebar-link">URL路径传递(*)</a></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#请求头传递" class="sidebar-link">请求头传递</a></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#二级域名传递" class="sidebar-link">二级域名传递</a></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#路由的namespace传递" class="sidebar-link">路由的namespace传递</a></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#反向生成url" class="sidebar-link">反向生成URL</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/0ef862/#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/pages/f2da32/" class="sidebar-link">drf认证</a></li><li><a href="/pages/eae3da/" class="sidebar-link">drf限流</a></li><li><a href="/pages/a5a0fe/" class="sidebar-link">asyncio异步编程</a></li><li><a href="/pages/e114db/" class="sidebar-link">asyncio实战案例</a></li><li><a href="/pages/0d4dbc/" class="sidebar-link">面向对象进阶</a></li><li><a href="/pages/0a9f75/" class="sidebar-link">Django启动时自动执行文件</a></li><li><a href="/pages/49e8fb/" class="sidebar-link">基于xml的rpc库</a></li><li><a href="/pages/cc289a/" class="sidebar-link">基于json的rpc库</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/backend" title="后端-目录页" data-v-1cd794fe>后端</a></li> <li data-v-1cd794fe><a href="/backend/#Python" title="后端#Python" data-v-1cd794fe>Python</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/sword-demon" target="_blank" title="作者" class="beLink" data-v-1cd794fe>wxvirus</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-10-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          drf学习
        </h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="drf-学习"><a href="#drf-学习" class="header-anchor">#</a> drf 学习</h1> <h2 id="快速上手"><a href="#快速上手" class="header-anchor">#</a> 快速上手</h2> <ul><li><p>安装</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>pip <span class="token function">install</span> <span class="token assign-left variable">djangorestframework</span><span class="token operator">=</span><span class="token number">3.12</span>.4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>版本要求: djangorestframework=3.12.4
	Python (3.5,3.6,3.7,3.8,3.9)
	Django(2.2, 3.0, 3.1)
	
djangorestframework=3.11.2
Python (3.5,3.6,3.7,3.8)
Django(1.11, 2.0, 2.1, 2.2, 3.0)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>配置，在<code>settings.py</code>中添加配置</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
  	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  	<span class="token comment"># 注册 rest_framework</span>
    <span class="token string">'rest_framework'</span>
<span class="token punctuation">]</span>

<span class="token comment"># drf相关配置写在这里</span>
REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>URL和视图</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># urls.py</span>

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># path('admin/', admin.site.urls),</span>

    <span class="token comment"># path(&quot;api/&lt;str:version&gt;/users&quot;, views.users),</span>
    <span class="token comment"># path(&quot;api/&lt;str:version&gt;/users/&lt;int:pk&gt;&quot;, views.users),</span>

    path<span class="token punctuation">(</span><span class="token string">'users/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># views.py</span>

<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response


<span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ul> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>其实drf框架是django基础进行的扩展，所以上述执行的底层实现流程还是和django的CBV类似。</p> <p>drf中重写了<code>as_view</code>和<code>dispatch</code>方法，就是在原来的django的功能的基础上加了一些功能</p> <ul><li><code>as_view</code>，免除了<code>csrf</code>的验证，前后端分离的项目一般不会使用<code>csrf_token</code>认证，会使用<code>jwt</code>认证</li> <li><code>dispatch</code>内部添加了版本处理、认证、权限、访问频率限制等诸多功能。</li></ul></div> <p>现在运行的一个页面</p> <p><img src="/vue-blog/assets/images/drf_runtime.png" alt="image-20210927212831528"></p> <h2 id="请求数据的封装"><a href="#请求数据的封装" class="header-anchor">#</a> 请求数据的封装</h2> <p>以前Django开发，视图中的request是<code>django.core.handlers.wsgi.WSGIRequest</code>类的对象，包含了请求相关的所有数据。</p> <p>而使用drf框架时，视图的request是<code>rest_framework.request.Request</code>类的对象，其实又是对django的request进行了一次封装，包含了除django原request对象以外，还包含其他后期会使用的其他对象。</p> <p>内部包含了django的request、认证、解析器等。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>新的request对象 = (django的request, 其他数据)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>源码位置</p> <p><code>rest_framework.requset.Request</code>类</p></blockquote> <details class="custom-block details"><summary>点击查看Request源码</summary> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Request</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Wrapper allowing to enhance a standard `HttpRequest` instance.

    Kwargs:
        - request(HttpRequest). The original request instance.
        - parsers(list/tuple). The parsers to use for parsing the
          request content.
        - authenticators(list/tuple). The authenticators used to try
          authenticating the request's user.
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> parsers<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> authenticators<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 negotiator<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parser_context<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> HttpRequest<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
            <span class="token string">'The `request` argument must be an instance of '</span>
            <span class="token string">'`django.http.HttpRequest`, not `{}.{}`.'</span>
            <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__module__<span class="token punctuation">,</span> request<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>_request <span class="token operator">=</span> request
        self<span class="token punctuation">.</span>parsers <span class="token operator">=</span> parsers <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>authenticators <span class="token operator">=</span> authenticators <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>negotiator <span class="token operator">=</span> negotiator <span class="token keyword">or</span> self<span class="token punctuation">.</span>_default_negotiator<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>parser_context <span class="token operator">=</span> parser_context
        self<span class="token punctuation">.</span>_data <span class="token operator">=</span> Empty
        self<span class="token punctuation">.</span>_files <span class="token operator">=</span> Empty
        self<span class="token punctuation">.</span>_full_data <span class="token operator">=</span> Empty
        self<span class="token punctuation">.</span>_content_type <span class="token operator">=</span> Empty
        self<span class="token punctuation">.</span>_stream <span class="token operator">=</span> Empty

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>parser_context <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>parser_context <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>parser_context<span class="token punctuation">[</span><span class="token string">'request'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self
        self<span class="token punctuation">.</span>parser_context<span class="token punctuation">[</span><span class="token string">'encoding'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>encoding <span class="token keyword">or</span> settings<span class="token punctuation">.</span>DEFAULT_CHARSET

        force_user <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'_force_auth_user'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        force_token <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'_force_auth_token'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> force_user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">or</span> force_token <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            forced_auth <span class="token operator">=</span> ForcedAuthentication<span class="token punctuation">(</span>force_user<span class="token punctuation">,</span> force_token<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>authenticators <span class="token operator">=</span> <span class="token punctuation">(</span>forced_auth<span class="token punctuation">,</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;%s.%s: %s %r&gt;'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__module__<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>method<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>get_full_path<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_default_negotiator</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> api_settings<span class="token punctuation">.</span>DEFAULT_CONTENT_NEGOTIATION_CLASS<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">content_type</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        meta <span class="token operator">=</span> self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>META
        <span class="token keyword">return</span> meta<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'CONTENT_TYPE'</span><span class="token punctuation">,</span> meta<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'HTTP_CONTENT_TYPE'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">stream</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns an object that may be used to stream the request content.
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> _hasattr<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_stream'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_load_stream<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_stream

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">query_params</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        More semantically correct name for request.GET.
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>GET

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">data</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> _hasattr<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_full_data'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_load_data_and_files<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_full_data

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns the user associated with the current request, as authenticated
        by the authentication classes provided to the request.
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> wrap_attributeerrors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_authenticate<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_user

    <span class="token decorator annotation punctuation">@user<span class="token punctuation">.</span>setter</span>
    <span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Sets the user on the current request. This is necessary to maintain
        compatibility with django.contrib.auth where the user property is
        set in the login and logout functions.

        Note that we also set the user on Django's underlying `HttpRequest`
        instance, ensuring that it is available to any middleware in the stack.
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>_user <span class="token operator">=</span> value
        self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>user <span class="token operator">=</span> value

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">auth</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Returns any non-user authentication information associated with the
        request, such as an authentication token.
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_auth'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> wrap_attributeerrors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_authenticate<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_auth

    <span class="token decorator annotation punctuation">@auth<span class="token punctuation">.</span>setter</span>
    <span class="token keyword">def</span> <span class="token function">auth</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Sets any non-user authentication information associated with the
        request, such as an authentication token.
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>_auth <span class="token operator">=</span> value
        self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>auth <span class="token operator">=</span> value

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">successful_authenticator</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Return the instance of the authentication instance class that was used
        to authenticate the request, or `None`.
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_authenticator'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> wrap_attributeerrors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_authenticate<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_authenticator

    <span class="token keyword">def</span> <span class="token function">_load_data_and_files</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Parses the request content into `self.data`.
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> _hasattr<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_data'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_files <span class="token operator">=</span> self<span class="token punctuation">.</span>_parse<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>_files<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_full_data <span class="token operator">=</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>_full_data<span class="token punctuation">.</span>update<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_files<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_full_data <span class="token operator">=</span> self<span class="token punctuation">.</span>_data

            <span class="token comment"># if a form media type, copy data &amp; files refs to the underlying</span>
            <span class="token comment"># http request so that closable objects are handled appropriately.</span>
            <span class="token keyword">if</span> is_form_media_type<span class="token punctuation">(</span>self<span class="token punctuation">.</span>content_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>_post <span class="token operator">=</span> self<span class="token punctuation">.</span>POST
                self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>_files <span class="token operator">=</span> self<span class="token punctuation">.</span>FILES

    <span class="token keyword">def</span> <span class="token function">_load_stream</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Return the content body of the request, as a stream.
        &quot;&quot;&quot;</span>
        meta <span class="token operator">=</span> self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>META
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            content_length <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>
                meta<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'CONTENT_LENGTH'</span><span class="token punctuation">,</span> meta<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'HTTP_CONTENT_LENGTH'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token keyword">except</span> <span class="token punctuation">(</span>ValueError<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            content_length <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">if</span> content_length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_stream <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">elif</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>_read_started<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_stream <span class="token operator">=</span> self<span class="token punctuation">.</span>_request
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_stream <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>self<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_supports_form_parsing</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Return True if this requests supports parsing form data.
        &quot;&quot;&quot;</span>
        form_media <span class="token operator">=</span> <span class="token punctuation">(</span>
            <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>
            <span class="token string">'multipart/form-data'</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>parser<span class="token punctuation">.</span>media_type <span class="token keyword">in</span> form_media <span class="token keyword">for</span> parser <span class="token keyword">in</span> self<span class="token punctuation">.</span>parsers<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_parse</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Parse the request content, returning a two-tuple of (data, files)

        May raise an `UnsupportedMediaType`, or `ParseError` exception.
        &quot;&quot;&quot;</span>
        media_type <span class="token operator">=</span> self<span class="token punctuation">.</span>content_type
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            stream <span class="token operator">=</span> self<span class="token punctuation">.</span>stream
        <span class="token keyword">except</span> RawPostDataException<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_request<span class="token punctuation">,</span> <span class="token string">'_post'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span>
            <span class="token comment"># If request.POST has been accessed in middleware, and a method='POST'</span>
            <span class="token comment"># request was made with 'multipart/form-data', then the request stream</span>
            <span class="token comment"># will already have been exhausted.</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>_supports_form_parsing<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>POST<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>FILES<span class="token punctuation">)</span>
            stream <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token keyword">if</span> stream <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> media_type <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> media_type <span class="token keyword">and</span> is_form_media_type<span class="token punctuation">(</span>media_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
                empty_data <span class="token operator">=</span> QueryDict<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span>self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>_encoding<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                empty_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            empty_files <span class="token operator">=</span> MultiValueDict<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>empty_data<span class="token punctuation">,</span> empty_files<span class="token punctuation">)</span>

        parser <span class="token operator">=</span> self<span class="token punctuation">.</span>negotiator<span class="token punctuation">.</span>select_parser<span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>parsers<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> parser<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> exceptions<span class="token punctuation">.</span>UnsupportedMediaType<span class="token punctuation">(</span>media_type<span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            parsed <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>stream<span class="token punctuation">,</span> media_type<span class="token punctuation">,</span> self<span class="token punctuation">.</span>parser_context<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            <span class="token comment"># If we get an exception during parsing, fill in empty data and</span>
            <span class="token comment"># re-raise.  Ensures we don't simply repeat the error when</span>
            <span class="token comment"># attempting to render the browsable renderer response, or when</span>
            <span class="token comment"># logging the request or similar.</span>
            self<span class="token punctuation">.</span>_data <span class="token operator">=</span> QueryDict<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span>self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>_encoding<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_files <span class="token operator">=</span> MultiValueDict<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_full_data <span class="token operator">=</span> self<span class="token punctuation">.</span>_data
            <span class="token keyword">raise</span>

        <span class="token comment"># Parser classes may return the raw data, or a</span>
        <span class="token comment"># DataAndFiles object.  Unpack the result as required.</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>parsed<span class="token punctuation">.</span>data<span class="token punctuation">,</span> parsed<span class="token punctuation">.</span>files<span class="token punctuation">)</span>
        <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>
            empty_files <span class="token operator">=</span> MultiValueDict<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>parsed<span class="token punctuation">,</span> empty_files<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_authenticate</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Attempt to authenticate the request using each authentication instance
        in turn.
        &quot;&quot;&quot;</span>
        <span class="token keyword">for</span> authenticator <span class="token keyword">in</span> self<span class="token punctuation">.</span>authenticators<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                user_auth_tuple <span class="token operator">=</span> authenticator<span class="token punctuation">.</span>authenticate<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            <span class="token keyword">except</span> exceptions<span class="token punctuation">.</span>APIException<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_not_authenticated<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">raise</span>

            <span class="token keyword">if</span> user_auth_tuple <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_authenticator <span class="token operator">=</span> authenticator
                self<span class="token punctuation">.</span>user<span class="token punctuation">,</span> self<span class="token punctuation">.</span>auth <span class="token operator">=</span> user_auth_tuple
                <span class="token keyword">return</span>

        self<span class="token punctuation">.</span>_not_authenticated<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_not_authenticated</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Set authenticator, user &amp; authtoken representing an unauthenticated request.

        Defaults are None, AnonymousUser &amp; None.
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>_authenticator <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token keyword">if</span> api_settings<span class="token punctuation">.</span>UNAUTHENTICATED_USER<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>user <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>UNAUTHENTICATED_USER<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token keyword">if</span> api_settings<span class="token punctuation">.</span>UNAUTHENTICATED_TOKEN<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>auth <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>UNAUTHENTICATED_TOKEN<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>auth <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        If an attribute does not exist on this instance, then we also attempt
        to proxy it to the underlying HttpRequest object.
        &quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_request<span class="token punctuation">,</span> attr<span class="token punctuation">)</span>
        <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__getattribute__<span class="token punctuation">(</span>attr<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">DATA</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span>
            <span class="token string">'`request.DATA` has been deprecated in favor of `request.data` '</span>
            <span class="token string">'since version 3.0, and has been fully removed as of version 3.2.'</span>
        <span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">POST</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Ensure that request.POST uses our request parsing.</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> _hasattr<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_data'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_load_data_and_files<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> is_form_media_type<span class="token punctuation">(</span>self<span class="token punctuation">.</span>content_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_data
        <span class="token keyword">return</span> QueryDict<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span>self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>_encoding<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">FILES</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Leave this one alone for backwards compat with Django's request.FILES</span>
        <span class="token comment"># Different from the other two cases, which are not valid property</span>
        <span class="token comment"># names on the WSGIRequest class.</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> _hasattr<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_files'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_load_data_and_files<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_files

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">QUERY_PARAMS</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span>
            <span class="token string">'`request.QUERY_PARAMS` has been deprecated in favor of `request.query_params` '</span>
            <span class="token string">'since version 3.0, and has been fully removed as of version 3.2.'</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">force_plaintext_errors</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Hack to allow our exception handler to force choice of</span>
        <span class="token comment"># plaintext or html error responses.</span>
        self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>is_ajax <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> value
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br></div></div><p>所以在使用drf的框架的requet的时候，会有一些不同，例如：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># Create your views here.</span>
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response


<span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 通过对象的嵌套直接找到request，读取相关值</span>
        request<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>method
        request<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>GET
        request<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>POST
        request<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>body

        <span class="token comment"># 直接去读新request对象中的值，一般此处会对原始数据的进行处理，方便在视图函数里使用</span>
        request<span class="token punctuation">.</span>query_params    <span class="token comment"># 内部本质上就是 request._request.GET</span>
        request<span class="token punctuation">.</span>data <span class="token comment"># 内部读取请求体中的数据，并进行处理，对请求者发送来的JSON会对JSON字符串进行反序列化</span>
        
        <span class="token comment"># 通过 __getattr__ 去访问reqeust._request 中的值</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></details> <p>drf内部会根据请求头<code>content-type</code>来进行内部处理数据然后组装完了扔到request里，方便我们进行使用。</p> <p><code>__getattr__</code>什么时候触发？</p> <p>当你调用了<code>reqeust.属性</code>就会去调用</p> <details class="custom-block details"><summary>点击查看代码</summary> <p>源码</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        If an attribute does not exist on this instance, then we also attempt
        to proxy it to the underlying HttpRequest object.
        &quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_request<span class="token punctuation">,</span> attr<span class="token punctuation">)</span>
        <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__getattribute__<span class="token punctuation">(</span>attr<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></details> <div class="language-python line-numbers-mode"><pre class="language-python"><code>request<span class="token punctuation">.</span>method <span class="token operator">=</span><span class="token operator">&gt;</span> self<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>method
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="版本管理"><a href="#版本管理" class="header-anchor">#</a> 版本管理</h2> <p>在restful规范中，后端的API需要体现版本</p> <p><code>drf</code>框架中支持5种版本的设置</p> <h3 id="get请求获取"><a href="#get请求获取" class="header-anchor">#</a> GET请求获取</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># views.py</span>

<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>versioning <span class="token keyword">import</span> QueryParameterVersioning
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response


<span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    versioning_class <span class="token operator">=</span> QueryParameterVersioning

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># urls.py</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> app01 <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># path('admin/', admin.site.urls),</span>

    <span class="token comment"># path(&quot;api/&lt;str:version&gt;/users&quot;, views.users),</span>
    <span class="token comment"># path(&quot;api/&lt;str:version&gt;/users/&lt;int:pk&gt;&quot;, views.users),</span>

    path<span class="token punctuation">(</span><span class="token string">'api/users/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>在浏览器中输入地址：http://127.0.0.1:8000/api/users/?version=v1</p> <p>此时终端会输出一个对应的版本号：<strong>v1</strong></p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>注意，浏览器输入的<code>version=v几</code>的<code>version</code>是固定的</p></div> <p>那么可以不可以修改呢，毕竟<code>version</code>要输入这么一长串</p> <details class="custom-block details"><summary>看下`QueryParameterVersioning`的源码的父类`BaseVersioning`</summary> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BaseVersioning</span><span class="token punctuation">:</span>
    default_version <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_VERSION
    allowed_versions <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>ALLOWED_VERSIONS
    version_param <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>VERSION_PARAM
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details> <p>其中的<code>VERSION_PARAM</code>，我们可以拿出来放到配置文件里，我们重新设置一下内容</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># settings.py</span>

<span class="token comment"># 之前说的drf的框架的配置文件都放在这个里面</span>
REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;VERSION_PARAM&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>写成这个时，后面浏览器写的时候传入的版本就得写：http://127.0.0.1:8000/api/users/?v=v1</p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>此时如果你还写成<code>version</code>就不行</p></div> <p>如果想设置一个默认值的版本，就是你不想写后面一串，如何设置一个默认值的版本？</p> <p>还是看上面的源码部分，里面有一个<code>DEFAULT_VERSION</code>看英文就知道是啥意思了。配置一下这个的默认值即可</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># settings.py</span>

REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;VERSION_PARAM&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;DEFAULT_VERSION&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token comment"># 设置默认版本为v1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>看到源码里还有一个<code>ALLOWED_VERSIONS</code>没用上，那肯定还是有用的啊，这个从字面上看就是可以允许的版本，我们可以进行限制一些版本名称</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># settings.py</span>

REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;VERSION_PARAM&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;DEFAULT_VERSION&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token comment"># 设置默认版本为v1</span>
  <span class="token string">&quot;ALLOWED_VERSIONS&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>此时浏览器只能传入<code>v1、v2、v3</code>，其余的就会出错</p></div> <h3 id="省事教程"><a href="#省事教程" class="header-anchor">#</a> 省事教程</h3> <p>此时，如果有多个视图，<code>versioning_class = QueryParameterVersioning</code>这一句是不是要在很多个视图类里都要写一遍。是的，很麻烦，<code>drf</code>还提供了一个解决办法。</p> <p><code>全局配置</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># settings.py</span>

REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;VERSION_PARAM&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;DEFAULT_VERSION&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># 设置默认版本为v1</span>
    <span class="token string">&quot;ALLOWED_VERSIONS&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;DEFAULT_VERSIONING_CLASS&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rest_framework.versioning.QueryParameterVersioning&quot;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><details class="custom-block details"><summary>查看源码位置</summary> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">APIView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># The following policies may be set at either globally, or per-view.</span>
    renderer_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_RENDERER_CLASSES
    parser_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_PARSER_CLASSES
    authentication_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_AUTHENTICATION_CLASSES
    throttle_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_THROTTLE_CLASSES
    permission_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_PERMISSION_CLASSES
    content_negotiation_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_CONTENT_NEGOTIATION_CLASS
    metadata_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_METADATA_CLASS
    versioning_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span>DEFAULT_VERSIONING_CLASS <span class="token comment"># 此处</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></details> <h3 id="url路径传递"><a href="#url路径传递" class="header-anchor">#</a> URL路径传递(*)</h3> <p><code>urls.py</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>path<span class="token punctuation">(</span><span class="token string">'api/&lt;str:version&gt;/users/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时视图函数内需要变更配置</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>versioning <span class="token keyword">import</span> URLPathVersioning


<span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    versioning_class <span class="token operator">=</span> URLPathVersioning

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>使用此方法后，前面的配置的<code>REST_FRAMEWORK</code>里的版本名称，也得和这里的<code>url</code>参数传递的一样为<code>version</code>,这也支持配置全局的地方进行使用。</p> <h3 id="请求头传递"><a href="#请求头传递" class="header-anchor">#</a> 请求头传递</h3> <p>去<code>headers</code>请求头里获取版本信息</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;Accept&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json;version=v3&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/vue-blog/assets/images/image-20211003195826500.png" alt="image-20211003195826500"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># Create your views here.</span>
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>versioning <span class="token keyword">import</span> QueryParameterVersioning<span class="token punctuation">,</span> URLPathVersioning<span class="token punctuation">,</span> AcceptHeaderVersioning
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response


<span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># versioning_class = QueryParameterVersioning</span>
    <span class="token comment"># versioning_class = URLPathVersioning</span>
    versioning_class <span class="token operator">=</span> AcceptHeaderVersioning

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><details class="custom-block details"><summary>查看源码</summary> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AcceptHeaderVersioning</span><span class="token punctuation">(</span>BaseVersioning<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    GET /something/ HTTP/1.1
    Host: example.com
    Accept: application/json; version=1.0
    &quot;&quot;&quot;</span>
    invalid_version_message <span class="token operator">=</span> _<span class="token punctuation">(</span><span class="token string">'Invalid version in &quot;Accept&quot; header.'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">determine_version</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        media_type <span class="token operator">=</span> _MediaType<span class="token punctuation">(</span>request<span class="token punctuation">.</span>accepted_media_type<span class="token punctuation">)</span>
        version <span class="token operator">=</span> media_type<span class="token punctuation">.</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>version_param<span class="token punctuation">,</span> self<span class="token punctuation">.</span>default_version<span class="token punctuation">)</span>
        version <span class="token operator">=</span> unicode_http_header<span class="token punctuation">(</span>version<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_allowed_version<span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> exceptions<span class="token punctuation">.</span>NotAcceptable<span class="token punctuation">(</span>self<span class="token punctuation">.</span>invalid_version_message<span class="token punctuation">)</span>
        <span class="token keyword">return</span> version

    <span class="token comment"># We don't need to implement `reverse`, as the versioning is based</span>
    <span class="token comment"># on the `Accept` header, not on the request URL.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></details> <h3 id="二级域名传递"><a href="#二级域名传递" class="header-anchor">#</a> 二级域名传递</h3> <p>效果就是 <code>v1.xxx.com:8000/api/users</code></p> <p>直接就在二级域名前加上版本 信息</p> <p>视图函数修改配置</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># Create your views here.</span>
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>versioning <span class="token keyword">import</span> QueryParameterVersioning<span class="token punctuation">,</span> URLPathVersioning<span class="token punctuation">,</span> AcceptHeaderVersioning<span class="token punctuation">,</span> \
    HostNameVersioning
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response


<span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># versioning_class = QueryParameterVersioning</span>
    <span class="token comment"># versioning_class = URLPathVersioning</span>
    <span class="token comment"># versioning_class = AcceptHeaderVersioning</span>
    versioning_class <span class="token operator">=</span> HostNameVersioning

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>自己如何想测试的话，<code>windows</code>的可以去修改hosts添加配置项</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>127.0.0.1 v1.xxx.com
127.0.0.1 v2.xxx.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <p>同样<code>mac</code>也是如此，但是<code>mac</code>需要获取到<code>root</code>权限才能去修改</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">su</span> - 

<span class="token comment"># 然后输入你的密码</span>

<span class="token function">vim</span> /etc/hosts <span class="token comment"># 应该是这个地址的。然后去添加上面的2个二级域名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后根据视图函数里的配置的信息，去测试请求获取的版本信息</p> <h3 id="路由的namespace传递"><a href="#路由的namespace传递" class="header-anchor">#</a> 路由的namespace传递</h3> <p><code>urls.py</code>需要做出修改</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> include
<span class="token keyword">from</span> app01 <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># path('admin/', admin.site.urls),</span>

    <span class="token comment"># path(&quot;api/&lt;str:version&gt;/users&quot;, views.users),</span>
    <span class="token comment"># path(&quot;api/&lt;str:version&gt;/users/&lt;int:pk&gt;&quot;, views.users),</span>

    <span class="token comment"># path('api/users/', views.UserView.as_view()),</span>
    path<span class="token punctuation">(</span><span class="token string">'api/v1'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'app01.urls'</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token string">'v1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'api/v2'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'app01.urls'</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token string">'v2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>视图函数对应的修改配置</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># Create your views here.</span>
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>versioning <span class="token keyword">import</span> QueryParameterVersioning<span class="token punctuation">,</span> URLPathVersioning<span class="token punctuation">,</span> AcceptHeaderVersioning<span class="token punctuation">,</span> \
    HostNameVersioning<span class="token punctuation">,</span> NamespaceVersioning
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response


<span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># versioning_class = QueryParameterVersioning</span>
    <span class="token comment"># versioning_class = URLPathVersioning</span>
    <span class="token comment"># versioning_class = AcceptHeaderVersioning</span>
    <span class="token comment"># versioning_class = HostNameVersioning</span>
    versioning_class <span class="token operator">=</span> NamespaceVersioning

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="反向生成url"><a href="#反向生成url" class="header-anchor">#</a> 反向生成URL</h3> <p>在每个版本处理的类中还定义了<code>reverse</code>方法， 它是用来反向生成URL并携带相关的版本信息用的。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>versioning <span class="token keyword">import</span> QueryParameterVersioning
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response


<span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    versioning_class <span class="token operator">=</span> QueryParameterVersioning

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
        <span class="token comment"># 反向生成URL</span>
        url1 <span class="token operator">=</span> request<span class="token punctuation">.</span>versioning_scheme<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token string">&quot;u1&quot;</span><span class="token punctuation">,</span> request<span class="token operator">=</span>request<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>url1<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><details class="custom-block details"><summary>某一个reverse源码</summary> <div class="language-python line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">reverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> viewname<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> request<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>extra<span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>
            viewname<span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwargs<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token punctuation">,</span> <span class="token operator">**</span>extra
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>version <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> replace_query_param<span class="token punctuation">(</span>url<span class="token punctuation">,</span> self<span class="token punctuation">.</span>version_param<span class="token punctuation">,</span> request<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
        <span class="token keyword">return</span> url
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></details> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>使用<code>drf</code>框架开发后端的<code>API</code>接口时：</p> <ul><li>首先创建Django项目</li> <li>安装drf框架</li> <li>创建一个app专门来处理用户请求</li> <li>注册app</li> <li>设置版本</li> <li>编写视图类</li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/sword-demon/edit/master/docs/01.后端/10.Python/01.drf学习.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=drf" title="标签">#drf</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/10/21, 20:43:49</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/1d456f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">进程间通信</div></a> <a href="/pages/f2da32/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">drf认证</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/1d456f/" class="prev">进程间通信</a></span> <span class="next"><a href="/pages/f2da32/">drf认证</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/d303b5/"><div>C语言简单代码解析</div></a> <span>07-04</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/3db013/"><div>IPV4 UDP</div></a> <span>07-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/2250c5/"><div>线性表</div></a> <span>06-30</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:2468170366@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/sword-demon" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/wxvirus" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>wxvirus</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.bac3fc37.js" defer></script><script src="/assets/js/2.5e51705b.js" defer></script><script src="/assets/js/16.f971791d.js" defer></script>
  </body>
</html>