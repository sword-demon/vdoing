---
title: 高并发秒杀设计
date: 2022-01-31 21:23:22
permalink: /pages/08222b/
categories:
    - 技术
    - 架构设计
tags:
    - null
---

## 秒杀的目标与挑战

-   系统目标
    -   C 端目标
        -   体验目标
            -   页面操作流畅
            -   无白屏
        -   稳定性目标
            -   接口稳定
            -   始终一致
            -   数据一致
    -   B 端目标
        -   价格隔离
        -   不能超卖
        -   活动保障
    -   平台目标
        -   流量隔离
        -   系统稳定
        -   风险隔离
-   目标特点
    -   瞬时大流量
    -   高并发
    -   高可用
    -   高性能
    -   读多写少
    -   一致性
-   技术挑战
    -   前端
        -   如何保证资源的加载速度
        -   如何打散流量
        -   如何保持始终一致性
    -   后端
        -   如何保证系统高可用
        -   如何削峰限流
        -   如何保证系统的响应速度
        -   如何保证秒杀品不被超卖
            -   库存扣减设计
        -   如何隔离流量和风险
        -   如何设计有效的缓存策略
        -   如何对付黄牛和秒杀器
    -   中间件
        -   如何应对突增的流量
        -   如何监控各环节状态和数据

## 秒杀系统的目标

> 通常，我们把秒杀看做是高并发的典型场景，是**大量请求**对**有限资源**的**瞬时争夺**，是用户对系统的发起的压力测试。然而，这话其实并不完全准确，秒杀与高并发的关系可疏可密。
>
> 因为，秒杀系统的核心目标是实现**大流量对优先资源的瞬时争夺**。围绕这个核心目标，我们可以进一步将秒杀拆解为 3 个目标，分别是*C 端目标、B 端目标和平台目标*

### C 端目标

**C 端用户是上帝**。在秒杀过程中上帝的体验是否顺畅、数据是否无误至关重要，所以我们要首先保障用户的体验。

对于大部分用户来说，体验是最直观的感受，突然的卡顿和白屏或者 404 或者 502 是糟糕的体验，会导致用户逐渐失去对我们的眷顾，甚至对我们的技术能力产生怀疑。而能否秒杀成功倒是其次，大部分用户在秒杀时都默认自己抢不到，他们不会因为抢不到而大为恼火，反而会因为，页面失误导致自己连参与的机会都没有会大失所望。

### B 端目标

**如果说 C 端用户是上帝，那么 B 端用户就是金主**，对于金主而言，在**价格、数量和资金**上都不能出错。

首先是价格，秒杀品的价格一般有别于其他渠道的商品，哪怕是同样的商品，价格也会存在差异，所以在价格上我们要做到渠道隔离。其次是数量，也就是不能**超卖**，超卖的后果很严重，会直接造成资损或服务无法兑现，客诉会接踵而至，甚至引发舆情。

最后是资金安全，除了超卖会导致资损外，还有一种情况也会造成资损，那就是**恶意下单**。如果你的竞争对手或者某些恶意用户在瞬间下单了你的所有商品，但就是不付款，这种情况会导致 B 端因在秒杀活动中无法进账而引发资损，不仅活动前期的推广费用、活动费用无法回收，可能还会导致更为严重的连锁反应。

### 平台目标

平台的目标肯定是前面 2 个都得顺利实现，但是不能在保证了前面 2 个都顺利了，而导致整个平台的其他业务 崩溃，否则就一败涂地。

从秒杀系统的目标来看，可以总结出几个秒杀过程中的明显的特征：

-   瞬时大流量：从秒杀开始的前期，流量会逐渐聚集，在秒杀开始的一瞬间，流量会瞬间涌入，监控图上也会体现出瞬间跳起，竖起一根芒刺
-   高并发：虽然大流量并不一定意味着高并发，但在秒杀场景中，大流量将直接导致高并发。高并发系统的设计与普通系统的设计有着很多不同，即使提供同样的服务，两者在设计上也会有着天壤之别
-   高可用：在任何情况下，我们都不能让系统宕机，不能让 C 端用户失望。
-   高性能：即使在洪峰流量下，也要保证 C 端用户的流畅体验。
-   读多写少：大流量是”读“，只有在并发中竞争成功的才会涉及到”写“。然而，成功者毕竟是极少数，所以”读多写少“也是一个关键性特征。
-   数据强一致性：数据一致性体现在两个方面，一是所有 C 端用户所看到的秒杀开始时间、库存等信息一致，二是最终成单数量与库存一致，不可以存在超卖的情况。
